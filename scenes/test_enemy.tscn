[gd_scene load_steps=24 format=3 uid="uid://xoaana6wd66l"]

[ext_resource type="Script" uid="uid://d16ieatpa6gb8" path="res://scripts/test_enemy.gd" id="1_fpxyv"]
[ext_resource type="Script" uid="uid://bo0ibaxyi3y8j" path="res://scripts/hurtbox.gd" id="2_mkyue"]
[ext_resource type="Texture2D" uid="uid://dwp5lw6f75qcp" path="res://assets/template_free/male_hero_template.png" id="2_t46gg"]
[ext_resource type="PackedScene" uid="uid://70283chaxaxy" path="res://scenes/enemy_weapon.tscn" id="3_t46gg"]
[ext_resource type="Script" uid="uid://br8s2pfencfh7" path="res://scripts/state_machine.gd" id="4_lkcdx"]
[ext_resource type="Script" uid="uid://b8u813j30u3cx" path="res://scripts/enemy_state_machine/enemy_idle.gd" id="5_8c00y"]
[ext_resource type="Script" uid="uid://dinglix0mke55" path="res://scripts/enemy_state_machine/enemy_chasing.gd" id="6_jqw88"]
[ext_resource type="Script" uid="uid://bi7nueyq3bnkh" path="res://scripts/enemy_state_machine/enemy_attacking.gd" id="7_1y3pe"]
[ext_resource type="Script" uid="uid://bauv1ijhod0mc" path="res://scripts/enemy_animation.gd" id="9_dddk1"]
[ext_resource type="Script" uid="uid://st6nl2uuyv25" path="res://scripts/enemy_wait.gd" id="9_hsgsh"]
[ext_resource type="AudioStream" uid="uid://cch805ng2ls28" path="res://assets/sounds/whoosh.mp3" id="9_vp4s7"]
[ext_resource type="Script" uid="uid://bngnoi6xqp0hr" path="res://scripts/parried.gd" id="10_ccqoy"]
[ext_resource type="AnimationNodeStateMachine" uid="uid://sccv00c6phxu" path="res://scenes/test_enemy_anim_state_machine.tres" id="13_m1dgl"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_mkyue"]
size = Vector2(22, 32)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_h17bh"]
size = Vector2(26, 34)

[sub_resource type="Animation" id="Animation_dddk1"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [Vector2i(2, 8)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:self_modulate")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 0, 0, 1)]
}

[sub_resource type="Animation" id="Animation_t46gg"]
resource_name = "attack"
length = 0.6
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.099999994, 0.20000002, 0.3, 0.4, 0.5, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 8), Vector2i(2, 8), Vector2i(1, 8), Vector2i(0, 8), Vector2i(0, 7), Vector2i(1, 7), Vector2i(2, 7)]
}

[sub_resource type="Animation" id="Animation_vp4s7"]
resource_name = "idle"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.10000001, 0.19999996, 0.29999995, 0.39999998, 0.49999997, 0.6, 0.6999999, 0.79999995, 0.9),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 1), Vector2i(1, 1), Vector2i(2, 1), Vector2i(3, 1), Vector2i(4, 1), Vector2i(5, 1), Vector2i(6, 1), Vector2i(7, 1), Vector2i(8, 1), Vector2i(9, 1)]
}

[sub_resource type="Animation" id="Animation_hsgsh"]
resource_name = "run"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.10000001, 0.20000002, 0.3, 0.40000004, 0.5, 0.6, 0.70000005, 0.8000001, 0.90000004),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 3), Vector2i(1, 3), Vector2i(2, 3), Vector2i(3, 3), Vector2i(4, 3), Vector2i(5, 3), Vector2i(6, 3), Vector2i(7, 3), Vector2i(8, 3), Vector2i(9, 3)]
}

[sub_resource type="Animation" id="Animation_m1dgl"]
resource_name = "stunned"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:self_modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.19999999, 0.5, 0.7, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Color(1, 0, 0, 1), Color(1, 1, 1, 1), Color(1, 0, 0, 1), Color(1, 1, 1, 1), Color(1, 0, 0, 1)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_vp4s7"]
_data = {
&"RESET": SubResource("Animation_dddk1"),
&"attack": SubResource("Animation_t46gg"),
&"idle": SubResource("Animation_vp4s7"),
&"run": SubResource("Animation_hsgsh"),
&"stunned": SubResource("Animation_m1dgl")
}

[sub_resource type="AnimationNodeTimeScale" id="AnimationNodeTimeScale_q4b65"]

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_ausen"]
nodes/output/position = Vector2(580, 140)
nodes/EnemyState/node = ExtResource("13_m1dgl")
nodes/EnemyState/position = Vector2(80, 120)
nodes/TimeScale/node = SubResource("AnimationNodeTimeScale_q4b65")
nodes/TimeScale/position = Vector2(400, 120)
node_connections = [&"output", 0, &"TimeScale", &"TimeScale", 0, &"EnemyState"]

[node name="test_enemy" type="CharacterBody2D"]
script = ExtResource("1_fpxyv")

[node name="Sprite2D" type="Sprite2D" parent="."]
self_modulate = Color(1, 0, 0, 1)
texture_filter = 1
texture = ExtResource("2_t46gg")
hframes = 10
vframes = 9
frame = 82

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_mkyue")

[node name="EnemyWeapon" parent="." instance=ExtResource("3_t46gg")]
visible = false
position = Vector2(12, 0)

[node name="Hurtbox" type="Area2D" parent="."]
script = ExtResource("2_mkyue")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Hurtbox"]
position = Vector2(0, -1)
shape = SubResource("RectangleShape2D_h17bh")
debug_color = Color(0.98338693, 0, 0.35783058, 0.41960785)

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("4_lkcdx")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateMachine" node_paths=PackedStringArray("enemy")]
script = ExtResource("5_8c00y")
enemy = NodePath("../..")

[node name="Chasing" type="Node" parent="StateMachine" node_paths=PackedStringArray("enemy")]
script = ExtResource("6_jqw88")
enemy = NodePath("../..")

[node name="Attacking" type="Node" parent="StateMachine" node_paths=PackedStringArray("enemy")]
script = ExtResource("7_1y3pe")
enemy = NodePath("../..")

[node name="Wait" type="Node" parent="StateMachine"]
script = ExtResource("9_hsgsh")

[node name="Parried" type="Node" parent="StateMachine"]
script = ExtResource("10_ccqoy")

[node name="AttackSound" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource("9_vp4s7")
pitch_scale = 0.5

[node name="EnemyAnimation" type="Node" parent="." node_paths=PackedStringArray("enemy", "animation_tree")]
script = ExtResource("9_dddk1")
enemy = NodePath("..")
animation_tree = NodePath("../AnimationTree")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_vp4s7")
}

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeBlendTree_ausen")
advance_expression_base_node = NodePath("..")
anim_player = NodePath("../AnimationPlayer")
parameters/EnemyState/conditions/attacking = false
parameters/EnemyState/conditions/parried = false
parameters/TimeScale/scale = 1.0
